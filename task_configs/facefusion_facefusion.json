{
  "app_id": "facefusion",
  "name": "视频人脸处理-FaceFusion",
  "description": "基于FaceFusion的视频人脸替换工具，能够将指定的人脸图像替换到视频中的目标人物。支持高精度人脸检测与融合，自动进行人脸增强处理，确保替换效果自然逼真。支持多种视频格式（MP4/AVI/MOV/MKV），适用于视频创作、内容制作等场景。",
  "author": "FaceFusion Team",
  "homepage": "https://github.com/facefusion/facefusion",
  "email": "team@example.com",
  "inputs": [
    {
      "label": "人脸图像",
      "field_name": "face_image",
      "type": "file",
      "default_value": "",
      "file_extensions": [
        "jpg",
        "jpeg",
        "png"
      ],
      "editable": true,
      "required": false
    },
    {
      "label": "目标视频",
      "field_name": "input_video",
      "type": "file",
      "file_extensions": [
        "mp4",
        "avi",
        "mov",
        "mkv"
      ],
      "default_value": "",
      "editable": true,
      "required": true
    },
    {
      "editable": true,
      "options": [
        {
          "label": "人脸替换",
          "value": "face_swapper"
        },
        {
          "label": "人脸增强",
          "value": "face_enhancer"
        }
      ],
      "default_value": "face_swapper",
      "label": "任务类型",
      "type": "select",
      "required": true,
      "field_name": "task_type"
    }
  ],
  "variables": {
    "work_dir": "$HOME/facefusion"
  },
  "server_output": "/tmp/facefusion_results/result.mp4",
  "model_path": "$HOME/.cache/facefusion_models",
  "installs": [
    {
      "env_name": "facefusion",
      "python_version": "3.12",
      "cuda_version": "12.9",
      "commands": [
        "rm -rf {work_dir}",
        "mkdir -p {work_dir}",
        "mkdir -p {server_output_dir}",
        "conda install -y ffmpeg=7.1.1 -c conda-forge",
        "git clone https://github.com/facefusion/facefusion {work_dir}",
        "cd {work_dir}",
        "python install.py --onnxruntime cuda"
      ]
    }
  ],
  "batch": [
    {
      "name": "人脸融合",
      "env_name": "facefusion",
      "commands": [
        "mkdir -p $(dirname {server_output})",
        "cd {work_dir}",
        "if [ \"{task_type}\" = \"face_swapper\" ]; then",
        "python facefusion.py headless-run --download-providers huggingface --execution-providers cuda --processors face_swapper face_enhancer --source-paths {face_image} --target-path {input_video} --output-path {server_output}",
        "elif [ \"{task_type}\" = \"face_enhancer\" ]; then",
        "python facefusion.py headless-run --download-providers huggingface --execution-providers cuda --processors face_enhancer --target-path {input_video} --output-path {server_output}",
        "else",
        "echo \"请选择任务类型\"",
        "exit 1",
        "fi"
      ]
    }
  ],
  "endpoint": "echo \"{server_output}\""
}